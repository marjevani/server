<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <title>הוספת סרט</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <style>
            .bottomButton{
               margin:10px;
            }
            #imgInp{
                width:200px;
            }
            #projection{
                width:350px;
            }
            #bigTbl td{
                padding:15px;
            }
            
            #internalTbl td{
                padding:5px;
            }
            #bigTbl {
                border-collapse: collapse;
               margin-top:30px;
            }
            body {
                     background-image: url("/images/background.jpg");
                    background-attachment: fixed;
            }
            h4{ text-align:center;
                margin:5px;
                padding:5px; /*ממרכז את הכתב*/
                color:white;
                position:relative;
                }  

           #imgshow{
               width:200px;
               height:200px;
           }
                 
        </style>
        <script>
            var user = JSON.parse(localStorage.getItem("user"));
            var numOfProj = 0;
            var max_projection = 5;
            var allProj = [];
            

            function addMovie()
            {
                var movie = {
                    name: $("#name").val(),
                    publish_date: $("#publish_date").val(),
                    langth: $("#langth").val(),
                    genre: $('#genre').find(":selected").text()
                };

                var fd = new FormData();
                // append movie
                var movie_string = JSON.stringify(movie);
                fd.append("movie", movie_string);
                
                // append image
                fd.append("img", $("#imgInp")[0].files[0]);

                // append PlayTime data
                fd.append("numOfProj", numOfProj);
                fd.append("sits", $("#sits").val());
                for (var i = 0; i < numOfProj; i++)
                    fd.append("projection" + i, $("#projection" + i).val());

                // send all data
                $.ajax({
                    url: "/api/Movie",
                    type: "PUT",
                    data: fd,
                    contentType: false,
                    processData: false,
                    success: function ()
                    {
                        alert("הסרט נוסף בהצלחה!");
                        location.reload();
                    },
                    error: function (xhr, textStatus, errorThrown)
                    {
                        alert(xhr.responseText);
                    }
                });
            }


            function addProjection() {
                if (numOfProj < max_projection)
                {
                    if (numOfProj == 0)
                    {
                        $("#projection").empty();
                    }                    
                    var d = document.createElement("div");
                    d.style.margin = "5px";
                   
                    var dateTime = document.createElement("input");
                    dateTime.type = "datetime-local";
                    dateTime.id = "projection" + numOfProj;

                    var spn = document.createElement("span");
                    numOfProj++;
                    spn.innerHTML = numOfProj + ".";

                    var list = document.getElementById("projection");

                    d.appendChild(spn);
                    d.appendChild(dateTime);
                    list.appendChild(d);
                }
            }


            $(document).ready(function ()
            {
               var list = document.getElementById("projection");
                var d = document.createElement("div");
                d.style.margin = "5px";
                var spn = document.createElement("span");
                spn.innerHTML = "לא הוכנסו הקרנות";
                d.appendChild(spn);
                list.appendChild(d);
            })
                

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('imgshow').src = e.target.result;
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

        </script>
    </head>

<body dir="rtl" >

    <table id="bigTbl" align="center">
        <tr>
            <td colspan= "3"><h4 class="w3-blue">הוספת סרט חדש</h4></td>
        </tr>
        <tr>
            <td>
                <img id="imgshow" src="/images/first_img.JPG" />
            </td>

            <td>
                <table id="internalTbl" align="center">
                    <tr><td class="w3-text-white"> שם הסרט </td><td><input type="text" id="name"/></td></tr>
                    <tr><td class="w3-text-white">   מספר מקומות</td><td><input type="text" id="sits"/></td></tr><!--לעשות סלקט עם האפשרויות  -->
                    <tr><td class="w3-text-white">    תאריך הוצאה</td><td><input type="date" id="publish_date"/></td></tr><!--לעשות סלקט עם האפשרויות  -->
                    <tr>
                        <td class="w3-text-white" >    ז'אנר</td>
                        <td>
                            <select id="genre">
                                <option>פעולה</option>
                                <option>מתח</option>
                                <option>קומדיה</option>
                                <option>דרמה</option>
                                <option>רומנטי</option>
                                <option>אימה</option>
                            </select>
                        </td>
                    </tr>
                    <tr><td class="w3-text-white">  אורך הסרט בדקות</td><td><input type="text" id="langth"/></td></tr>
                    <tr><td class="w3-text-white"> תמונה</td><td><input type="file" id="imgInp" onchange="readURL(this);" /></td></tr>
                </table>
            </td>

            <td class="w3-display-container">
                <table class="w3-display-top">
                    <tr>
                        <td class="w3-text-white ">הקרנות:</td>
                        <td id="projection" align="center"></td>
                        <td align="center" class=""> <input type="button" value="הוסף הקרנה" onclick="addProjection()" /> </td>
                    </tr>
                </table>
            </td>
        </tr>

        <tr >
            <td class="w3-text-white" align="center" colspan="3">
                <input type="button" value="הוסף" class="bottomButton" onclick="addMovie()" />
                <input type="button" value="מחק" class="bottomButton" onclick="location.reload()" />
            </td>
        </tr>
    </table>

       
        
</body>
</html>
