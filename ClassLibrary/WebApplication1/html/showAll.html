<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   
    <title>סרטים מוצגים בקולנוע</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>

        .gallery td {
            padding: 5px;
            width:200px;
            height:200px;
             position:relative;
        }


        #bigTbl {
            border-collapse: collapse;
            margin-top: 30px;
             padding:10px;
        }

        body {
            background-image: url("/images/background.jpg");
            background-attachment: fixed;
        }
        h4{ text-align:center;
                margin:5px;
                padding:5px; /*ממרכז את הכתב*/
                color:white;
                position:relative;
                width:1100px;
                }  
        /*.available td div*/
        .internalDiv{
             width:200px;
            text-align:center         
        }
       img{
            width:100px;
            height:100px;
            margin:5px;
           
       }
       #hello
       {
           margin:5px;
           padding:5px;
            border:1px dashed  black;
            display:inline;
       }
       .avi{
           margin-left:20px;
       }
   
       .lowerDiv
       {
          text-align: center;
       }
       .adminDiv
       {
          display:inline;
       }
       
    </style>
    <script>
        var user = JSON.parse(localStorage.getItem("user"));
        var numOfAvailableSits;
        var itemInRow = 5;
       

        $(document).ready(function () {
            // hello messege - top
            var $spn = document.getElementById("hello");
            $spn.innerHTML = "שלום " + user.name;

            if (user.isAdmin == 1) {
                var $add = $("<button>").text("הוסף סרט");
                $add.click(function () { location.href = "addMovie.html" });
                $("#admin").append($add).attr("class", "adminDiv");
                $spn.innerHTML += ", באפשרותך להזמין סרט או להוסיף סרט חדש";
            }
            else {
                $spn.innerHTML += ",איזה סרט תרצה להזמין?";
            }

            var $tbl = $("<table>").attr("class", "available");
            var $tr = $("<tr>");
            var counter = 0;

            $.ajax({
                dataType: "json",
                url: "/api/movie",
                contentType: "application/json; charset=utf-8",
                type: "GET",
                success: function (data) {
                    for (i in data)
                    {
                        if (counter == itemInRow) {
                            $tr = $("<tr>");
                            counter = 0;
                        }
                        counter++;
                        var $td = $("<td>").attr("class", "w3-white");
                        var $div = $("<div>").attr({ "class": "internalDiv", "data-id": data[i].id });
                        var $nameP = $("<span>").attr("data-name", data[i].name).text("שם הסרט:" + data[i].name);
                        date = new Date(data[i].publish_date);
                        var $publishDate = $("<span>").text("תאריך פרסום:" + date.toLocaleDateString());
                        var $langth = $("<span>").text("אורך הסרט:" + data[i].langth + " דקות");
                        var $genre = $("<span>").html("ז'אנר:" + data[i].genre);
                        var $pic = $("<img>").attr({ "src": "/images/"+ data[i].img, "movie-number-pic": i + 1 });
                        var $btn = $("<button>").text("הצג הקרנות").click(function () {
                                localStorage.setItem("movie_id", JSON.stringify(this.parentElement.getAttribute("data-id")));
                                localStorage.setItem("movie_name", JSON.stringify(this.parentElement.firstElementChild.getAttribute("data-name")));
                                location.href = "playForMovie.html"
                            });

                       $div.append($nameP);
                       $div.append($("<br>"));
                       $div.append($publishDate);
                       $div.append($("<br>"));
                       $div.append($langth);
                       $div.append($("<br>"));
                       $div.append($genre);
                       $div.append($("<br>"));
                       $div.append($("<br>"));
                       $div.append($pic);
                       $div.append($("<br>"));
                       $div.append($btn);
                       $td.append($div);
                       $tr.append($td);
                       $tbl.append($tr);
                       $("#availableTbl").append($tbl);
                      
                    }//for

                }, //success_data
                error: function () {
                    console.log("connection ERROR - Available movies");

                } //error
            });

        }); //document


    </script>

</head>
<body dir="rtl">
    <br />
    <span class="w3-white" id="hello" ></span>
    <div id="admin"></div>
    <table id="bigTbl" align="center">
        <tr>
            <td colspan="5"><h4 class="w3-blue head">סרטים זמינים</h4></td>
        </tr>

        <tr class="gallery">
            <td colspan="5">
                <div class="w3-text-blue" id="availableTbl">
                 
                    
                </div>

            </td>

      




</table>

</body>
</html>
