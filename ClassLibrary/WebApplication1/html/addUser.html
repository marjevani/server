<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>הוספת לקוח חדש</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>

    <style>
        body {
            background-image: url("/images/background.jpg");
            background-attachment: fixed;
        }

        #board {
            width: 500px;
            height: 300px;
            background-color: blanchedalmond;
            position: relative;
            top: 100px;
            border: 1px dashed black;
        }

 
    </style>
    <script>
        var machPasswords = false;

        $(document).ready(function () {
            $("#form").submit(function (event) {
                event.preventDefault();
                if(machPasswords==true)
                    addUser();
                $(function () {
                    $("#includedContent").load("messegeModule.html");
                });
            });

            $('#password, #confirm_password').on('keyup', function () {
                if ($('#password').val() == "" || $('#confirm_password').val() == "")
                {
                    $('#message').html('');
                }
                else if ($('#password').val() == $('#confirm_password').val())
                {
                    $('#message').html('סיסמאות תואמות').removeClass("w3-red").addClass("w3-green");
                    machPasswords = true;
                }
                else
                {
                    $('#message').html('סיסמאות לא תואמות').removeClass("w3-green").addClass("w3-red");
                    machPasswords = false;
                }
            });
        })

        function addUser()
        {
            var fd = new FormData();

            // create Customer
            var customer = {
                    id: document.getElementById("user_id").value,
                    name: document.getElementById("user_name").value,
                    pass: document.getElementById("password").value,
                    isAdmin: false
            };

            // append Customer
            var customer_string = JSON.stringify(customer);
            fd.append("customer", customer_string);

            // send data
                $.ajax({
                    url: "/api/customer",
                    contentType: "application/json; charset=utf-8",
                    type: "PUT",
                    data: fd,
                    contentType: false,
                    processData: false,
                    success: function (msg) {
                        succMsg("הודעה", false); //    להשלים הודעות, לא תמיד לעבוד ישר לעמוד הצפיה הרגיל
                        localStorage.setItem("user", JSON.stringify(user));
                        location.href = "showAll.html"
                    },
                    error: function () {
                        errorMsg("שגיאה בהוספת לקוח", true);
                    }
                });
            }

      
    </script>

</head>
<body dir="rtl" align="center">



    <div id="wrapper" style="padding:10px;" align="center">
        <div id="board" align="center">

            <form id="form" autocomplete="off">
                <h2 id="h1"></h2>
                <h2>הוספת לקוח חדש:</h2>
                <table>
                    <tr>
                        <td>תעודת זהות:</td>
                        <td><input type="number" id="user_id" autofocus required /></td>
                    </tr>
                    <tr>
                        <td>שם: </td>
                        <td> <input type="text" id="user_name" required /></td>
                    </tr>
                    <tr>
                        <td>סיסמא:</td>
                        <td> <input type="password" id="password" required /></td>
                    </tr>
                    <tr>
                        <td>וידוא סיסמא:</td>
                        <td>
                            <input type="password" id="confirm_password" required />
                        </td>
                    </tr>

                </table>
                <span id="message" class="w3-red"></span> <br /><br />
                <input type="submit" value="הוסף לקוח" id="addbtn" />
                <input type="button" value="חזרה לדף הראשי" onclick="location.href = 'login.html'" />
            </form>

        </div>
    </div>
    
    <!--add module for animated messeges-->
    <div id="includedContent"></div>

</body>
</html>
